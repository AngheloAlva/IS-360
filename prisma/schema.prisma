generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum USER_ROLE {
  USER
  ADMIN
  OPERATOR
  SUPERVISOR
  PARTNER_COMPANY
}

enum AREAS {
  OPERATIONS // Operaciones
  INSTRUCTIONS // Instructivos
  INTEGRITY_AND_MAINTENANCE // Integridad y Mantencion
  ENVIRONMENT // Medio Ambiente
  OPERATIONAL_SAFETY // Seguridad Operacional
  QUALITY_AND_OPERATIONAL_EXCELLENCE // Calidad y Exelencia Operacional
  REGULATORY_COMPLIANCE // Cumplimiento Normativo
  LEGAL // Juridica
  COMMUNITIES // Comunidades (periodistas?)
  PROJECTS // Proyectos
  PURCHASING // Compras
  ADMINISTRATION_AND_FINANCES // Administración y Finanzas
  IT // Informática
  GERENCY // Gerencia
}

enum MODULES {
  ALL // Todo
  EQUIPMENT // Equipos
  SAFETY_TALK // Charlas de seguridad
  WORK_ORDERS // Ordenes de Trabajo
  WORK_PERMITS // Permisos de Trabajo
  DOCUMENTATION // Documentacion
  NONE // Sin módulo
}

model User {
  id               String    @id
  name             String
  email            String
  emailVerified    Boolean
  image            String?
  phone            String?
  createdAt        DateTime
  updatedAt        DateTime
  modules          MODULES[]
  role             USER_ROLE @default(PARTNER_COMPANY)
  internalRole     String?
  area             AREAS?
  banned           Boolean?
  banReason        String?
  banExpires       DateTime?
  rut              String
  twoFactorEnabled Boolean?

  sessions                       Session[]
  accounts                       Account[]
  files                          File[]
  folders                        Folder[]
  workTrackers                   WorkTracker[]
  safetyTalks                    UserSafetyTalk[]
  workApplications               WorkApplication[]
  company                        Company?              @relation(fields: [companyId], references: [id])
  companyId                      String?
  isSupervisor                   Boolean?
  workOrders                     WorkOrder[]           @relation("WorkOrderResponsible")
  workOrdersAsSupervisor         WorkOrder[]           @relation("WorkOrderSupervisor")
  requestedClosures              WorkOrder[]           @relation("WorkOrderClosureRequester")
  approvedClosures               WorkOrder[]           @relation("WorkOrderClosureApprover")
  assignedEntries                WorkEntry[]           @relation("AssignedUsers")
  createdEntries                 WorkEntry[]           @relation("WorkEntryCreator")
  signedEntries                  WorkEntry[]           @relation("WorkEntrySigner")
  workEntries                    WorkEntry[]           @relation("WorkEntryApproval")
  workPermitsAsParticipant       WorkPermit[]          @relation("WorkPermitParticipants")
  workPermitsAsPreventionOfficer WorkPermit[]          @relation("PreventionOfficer")
  workPermits                    WorkPermit[]          @relation("WorkPermitUser")
  attachmentsHistory             AttachmentHistory[]
  equipmentHistory               EquipmentHistory[]
  fileHistory                    FileHistory[]
  twofactors                     TwoFactor[]
  rootFolder                     RootFolder[]
  FileComment                    FileComment[]
  MaintenancePlan                MaintenancePlan[]
  MaintenancePlanTask            MaintenancePlanTask[] @relation("MaintenancePlanTaskResponsible")
  MaintenancePlanTaskCreatedBy   MaintenancePlanTask[] @relation("MaintenancePlanTaskCreatedBy")

  @@unique([email])
  @@unique([rut])
  @@map("user")
}

model RutCounter {
  id    String @id @default("rut_counter")
  value Int    @default(1)

  @@map("rut_counter")
}

model TwoFactor {
  id          String
  secret      String?
  backupCodes String?

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  @@unique([id])
  @@unique([userId])
  @@map("twoFactor")
}

model Session {
  id             String   @id
  expiresAt      DateTime
  token          String
  createdAt      DateTime
  updatedAt      DateTime
  ipAddress      String?
  userAgent      String?
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  impersonatedBy String?

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime

  @@map("account")
}

model Company {
  id String @id @default(cuid())

  name String
  rut  String

  users               User[]
  workOrders          WorkOrder[]
  workPermits         WorkPermit[]
  vehicles            Vehicle[]
  rootFolders         RootFolder[]
  MaintenancePlanTask MaintenancePlanTask[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id])
  @@map("company")
}

enum VEHICLE_TYPE {
  CAR
  TRUCK
  MOTORCYCLE
  BUS
  TRACTOR
  TRAILER
  OTHER
}

model Vehicle {
  id String @id @default(cuid())

  plate  String
  model  String
  year   Int
  brand  String
  type   VEHICLE_TYPE
  color  String?
  isMain Boolean      @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company     Company      @relation(fields: [companyId], references: [id])
  companyId   String
  workPermits WorkPermit[]

  @@map("vehicle")
}

model Verification {
  id         String    @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

enum WORK_ORDER_STATUS {
  PLANNED
  PENDING
  COMPLETED
  CANCELLED
  IN_PROGRESS
  CLOSURE_REQUESTED
}

enum WORK_ORDER_TYPE {
  CORRECTIVE
  PREVENTIVE
  PREDICTIVE
  PROACTIVE
}

enum WORK_ORDER_CAPEX {
  CONFIDABILITY // Confiabilidad
  MITIGATE_RISK // Mitiga riesgo
  COMPLIANCE // Cumplimiento normativo
}

enum WORK_ORDER_PRIORITY {
  HIGH
  MEDIUM
  LOW
}

model WorkOrder {
  id       String @id @default(cuid())
  otNumber String

  type             WORK_ORDER_TYPE
  status           WORK_ORDER_STATUS   @default(PLANNED)
  solicitationDate DateTime
  solicitationTime String
  workRequest      String
  workDescription  String?
  priority         WORK_ORDER_PRIORITY
  capex            WORK_ORDER_CAPEX?
  equipment        Equipment[]
  programDate      DateTime
  estimatedHours   Float
  estimatedDays    Float
  requiresBreak    Boolean
  breakDays        Int?
  estimatedEndDate DateTime?
  isWorkBook       Boolean
  isWorkBookInit   Boolean             @default(false)

  // Work book data
  workName           String?
  workLocation       String?
  workStartDate      DateTime?
  workProgressStatus Float?      @default(0) // Cambiado a Float para precisión en el porcentaje
  workEntries        WorkEntry[]

  company               Company              @relation(fields: [companyId], references: [id])
  companyId             String
  supervisor            User                 @relation("WorkOrderSupervisor", fields: [supervisorId], references: [id])
  supervisorId          String
  responsible           User                 @relation("WorkOrderResponsible", fields: [responsibleId], references: [id])
  responsibleId         String
  initReport            Attachment?          @relation("WorkOrderInitReport", fields: [initReportId], references: [id])
  initReportId          String?              @unique
  endReport             Attachment?          @relation("WorkOrderEndReport", fields: [endReportId], references: [id])
  endReportId           String?              @unique
  workPermits           WorkPermit[]
  closureRequestedBy    User?                @relation("WorkOrderClosureRequester", fields: [closureRequestedById], references: [id])
  closureRequestedById  String?
  closureRequestedAt    DateTime?
  closureApprovedBy     User?                @relation("WorkOrderClosureApprover", fields: [closureApprovedById], references: [id])
  closureApprovedById   String?
  closureApprovedAt     DateTime?
  closureRejectedReason String?
  workTrackers          WorkTracker[]
  equipmentHistory      EquipmentHistory[]
  MaintenancePlanTask   MaintenancePlanTask? @relation(fields: [maintenancePlanTaskId], references: [id])
  maintenancePlanTaskId String?
  milestones            Milestone[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id])
  @@unique([otNumber])
  @@map("work_order")
}

model Milestone {
  id          String    @id @default(cuid())
  name        String
  description String?
  order       Int       @default(0)
  isCompleted Boolean   @default(false)
  progress    Float     @default(0)
  weight      Float     @default(1)
  startDate   DateTime?
  endDate     DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workOrder   WorkOrder       @relation(fields: [workOrderId], references: [id])
  workOrderId String
  tasks       MilestoneTask[]

  @@unique([id])
  @@index([workOrderId, order])
  @@map("milestone")
}

model MilestoneTask {
  id                String      @id @default(cuid())
  name              String
  description       String?
  order             Int         @default(0)
  isCompleted       Boolean     @default(false)
  plannedDate       DateTime?
  activityStartTime String?
  activityEndTime   String?
  estimatedHours    Float?
  estimatedPeople   Int?
  completedAt       DateTime?
  completedBy       String?
  comments          String?
  milestone         Milestone   @relation(fields: [milestoneId], references: [id], onDelete: Cascade)
  milestoneId       String
  workEntries       WorkEntry[]

  @@unique([id])
  @@index([milestoneId])
  @@map("milestone_task")
}

model Equipment {
  id            String  @id @default(cuid())
  barcode       String
  name          String
  description   String?
  location      String
  isOperational Boolean @default(true)
  type          String?
  tag           String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  parent              Equipment?            @relation("EquipmentHierarchy", fields: [parentId], references: [id])
  parentId            String?
  children            Equipment[]           @relation("EquipmentHierarchy")
  workOrders          WorkOrder[]
  history             EquipmentHistory[]
  MaintenancePlan     MaintenancePlan[]
  MaintenancePlanTask MaintenancePlanTask[]

  @@unique([id])
  @@unique([tag])
  @@unique([barcode])
  @@map("equipment")
}

enum WORK_APPLICATION_STATUS {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
  EXPIRED
}

model WorkApplication {
  id String @id @default(cuid())

  description String
  location    String
  status      WORK_APPLICATION_STATUS @default(PENDING)
  criticality String

  attachments   Attachment[]
  responsible   User         @relation(fields: [responsibleId], references: [id])
  responsibleId String

  @@unique([id])
  @@map("work_application")
}

enum ENTRY_TYPE {
  DAILY_ACTIVITY
  ADDITIONAL_ACTIVITY
  PREVENTION_AREA
  OTC_INSPECTION
  COMMENT
  USER_NOTE
}

enum NOTE_STATUS {
  PENDING
  ACKNOWLEDGED
  RESOLVED
}

enum APPROVAL_STATUS {
  PENDING
  APPROVED
  REJECTED
}

model WorkEntry {
  id                   String             @id @default(cuid())
  entryType            ENTRY_TYPE
  isFavorite           Boolean            @default(false)
  hasAttachments       Boolean            @default(false)
  executionDate        DateTime           @default(now())
  activityName         String?
  activityStartTime    String?
  activityEndTime      String?
  progressContribution Float? // Cuánto contribuye esta actividad al progreso de la tarea (0-100)
  comments             String?
  supervisionComments  String?
  safetyObservations   String?
  nonConformities      String?
  inspectorName        String?
  recommendations      String?
  others               String?
  noteStatus           NOTE_STATUS?       @default(PENDING)
  notificationSent     Boolean            @default(false)
  acknowledgedAt       DateTime?
  resolvedAt           DateTime?
  approvalStatus       APPROVAL_STATUS?   @default(PENDING)
  approvalDate         DateTime?
  approvalBy           User?              @relation("WorkEntryApproval", fields: [approvalById], references: [id])
  approvalById         String?
  createdAt            DateTime           @default(now())
  createdBy            User               @relation("WorkEntryCreator", fields: [createdById], references: [id])
  createdById          String
  signedAt             DateTime?
  signedBy             User?              @relation("WorkEntrySigner", fields: [signedById], references: [id])
  signedById           String?
  workOrder            WorkOrder          @relation(fields: [workOrderId], references: [id])
  workOrderId          String
  milestoneTask        MilestoneTask?     @relation(fields: [milestoneTaskId], references: [id])
  milestoneTaskId      String?
  assignedUsers        User[]             @relation(name: "AssignedUsers")
  referencedEntry      WorkEntry?         @relation("EntryReferences", fields: [referencedEntryId], references: [id])
  referencedEntryId    String?
  referencedBy         WorkEntry[]        @relation("EntryReferences")
  equipmentHistory     EquipmentHistory[]
  attachments          Attachment[]

  @@unique([id])
  @@index([workOrderId, createdAt])
  @@index([milestoneTaskId])
  @@map("work_book_entry")
}

model WorkTracker {
  id String @id @default(cuid())

  description     String
  date            DateTime
  dedicatedHours  Int
  quantityPersons Int
  location        String
  status          String

  user        User         @relation(fields: [userId], references: [id])
  userId      String
  attachments Attachment[]
  otNumber    WorkOrder    @relation(fields: [otNumberId], references: [id])
  otNumberId  String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("work_tracker")
}

model Attachment {
  id String @id @default(cuid())

  name String
  url  String
  type String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workApplication       WorkApplication?     @relation(fields: [workApplicationId], references: [id])
  workApplicationId     String?
  workEntry             WorkEntry?           @relation(fields: [workEntryId], references: [id])
  workEntryId           String?
  workTracker           WorkTracker?         @relation(fields: [workTrackerId], references: [id])
  workTrackerId         String?
  initReport            WorkOrder?           @relation("WorkOrderInitReport")
  initReportId          String?              @unique
  endReport             WorkOrder?           @relation("WorkOrderEndReport")
  endReportId           String?              @unique
  history               AttachmentHistory[]
  MaintenancePlanTask   MaintenancePlanTask? @relation(fields: [maintenancePlanTaskId], references: [id])
  maintenancePlanTaskId String?

  @@map("attachment")
}

enum WORK_PERMIT_STATUS {
  ACTIVE
  COMPLETED
  CANCELLED
  EXPIRED
}

model WorkPermit {
  id String @id @default(cuid())

  aplicantPt                     String
  responsiblePt                  String
  executanCompany                String
  mutuality                      String
  otherMutuality                 String?
  initDate                       DateTime
  endDate                        DateTime?
  hour                           String
  workersNumber                  Int
  workDescription                String
  exactPlace                     String
  workWillBe                     String
  workWillBeOther                String?
  tools                          String[]
  otherTools                     String?
  preChecks                      String[]
  otherPreChecks                 String?
  activityDetails                String[]
  riskIdentification             String[]
  otherRisk                      String?
  preventiveControlMeasures      String[]
  otherPreventiveControlMeasures String?
  generateWaste                  Boolean
  wasteType                      String?
  wasteDisposalLocation          String?
  whoDeliversWorkAreaOp          String
  workerExecutor                 String
  preventionOfficer              String
  preventionOfficerUser          User               @relation("PreventionOfficer", fields: [preventionOfficer], references: [id])
  whoReceives                    String?
  cleanAndTidyWorkArea           Boolean?
  workCompleted                  Boolean?
  observations                   String?
  additionalObservations         String?
  acceptTerms                    Boolean            @default(false)
  status                         WORK_PERMIT_STATUS @default(ACTIVE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  otNumber     WorkOrder @relation(fields: [otNumberId], references: [id])
  otNumberId   String
  user         User      @relation("WorkPermitUser", fields: [userId], references: [id])
  userId       String
  participants User[]    @relation("WorkPermitParticipants")
  company      Company   @relation(fields: [companyId], references: [id])
  companyId    String
  vehicles     Vehicle[]

  @@index([preventionOfficer])
  @@map("work_permit")
}

model Folder {
  id   String @id @default(cuid())
  slug String

  name        String
  description String?
  root        Boolean @default(false)
  area        AREAS
  type        String  @default("default")
  isExternal  Boolean @default(false)
  isActive    Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  parent     Folder?  @relation("FolderToFolder", fields: [parentId], references: [id])
  parentId   String?
  subFolders Folder[] @relation("FolderToFolder")
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  files      File[]

  @@unique([slug, parentId, userId])
  @@map("folder")
}

model File {
  id String @id @default(cuid())

  code             String?
  name             String
  description      String?
  area             AREAS?
  type             String
  size             Int
  url              String
  registrationDate DateTime
  expirationDate   DateTime?
  revisionCount    Int       @default(0)
  isExternal       Boolean   @default(false)
  isActive         Boolean   @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  history      FileHistory[]
  folder       Folder?       @relation(fields: [folderId], references: [id], onDelete: Cascade)
  folderId     String?
  rootFolder   RootFolder?   @relation(fields: [rootFolderId], references: [id], onDelete: Cascade)
  rootFolderId String?
  user         User          @relation(fields: [userId], references: [id])
  userId       String
  comments     FileComment[]

  @@map("file")
}

model FileComment {
  id String @id @default(cuid())

  title   String?
  content String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id])
  userId String
  file   File   @relation(fields: [fileId], references: [id])
  fileId String

  @@map("file_comment")
}

model Counter {
  id    String @id @default("ot_counter")
  value Int    @default(1)
}

enum RESOURCE_TYPE {
  VIDEO
  PRESENTATION
  DOCUMENT
}

model SafetyTalk {
  id                String               @id @default(cuid())
  slug              String               @unique
  title             String
  description       String?
  isPresential      Boolean              @default(false)
  questions         Question[]
  resources         SafetyTalkResource[]
  expiresAt         DateTime
  timeLimit         Int?
  minimumScore      Float                @default(70.0)
  pdfGenerations    Int                  @default(0)
  lastPdfGeneration DateTime?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt

  userSafetyTalks UserSafetyTalk[]

  @@map("safety_talk")
}

model SafetyTalkResource {
  id           String        @id @default(cuid())
  title        String
  description  String?
  type         RESOURCE_TYPE
  url          String
  fileSize     Int?
  mimeType     String?
  order        Int
  safetyTalk   SafetyTalk    @relation(fields: [safetyTalkId], references: [id])
  safetyTalkId String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@map("safety_talk_resource")
}

enum QUESTION_TYPE {
  MULTIPLE_CHOICE // Opción múltiple tradicional
  IMAGE_ZONES // Preguntas con zonas en imágenes
  TRUE_FALSE // Verdadero/Falso
  SHORT_ANSWER // Respuesta corta
}

model Question {
  id           String           @id @default(cuid())
  type         QUESTION_TYPE    @default(MULTIPLE_CHOICE)
  question     String
  imageUrl     String?
  description  String?
  options      QuestionOption[]
  safetyTalk   SafetyTalk       @relation(fields: [safetyTalkId], references: [id])
  safetyTalkId String
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  userAnswers UserSafetyTalkAnswer[]

  @@map("question")
}

model QuestionOption {
  id         String   @id @default(cuid())
  text       String
  isCorrect  Boolean
  zoneLabel  String? // Para IMAGE_ZONES, etiqueta de la zona (ej: 'A', 'B', 'C')
  zoneId     String? // Identificador único de la zona en la imagen
  order      Int      @default(0) // Orden de la opción
  question   Question @relation(fields: [questionId], references: [id])
  questionId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  userAnswers UserSafetyTalkAnswer[]

  @@map("question_option")
}

model UserSafetyTalk {
  id           String                 @id @default(cuid())
  user         User                   @relation(fields: [userId], references: [id])
  userId       String
  safetyTalk   SafetyTalk             @relation(fields: [safetyTalkId], references: [id])
  safetyTalkId String
  score        Float
  passed       Boolean
  completedAt  DateTime
  expiresAt    DateTime
  answers      UserSafetyTalkAnswer[]
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt

  @@map("user_safety_talk")
}

model UserSafetyTalkAnswer {
  id               String         @id @default(cuid())
  userSafetyTalk   UserSafetyTalk @relation(fields: [userSafetyTalkId], references: [id])
  userSafetyTalkId String
  question         Question       @relation(fields: [questionId], references: [id])
  questionId       String
  selectedOption   QuestionOption @relation(fields: [selectedOptionId], references: [id])
  selectedOptionId String
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  @@map("user_safety_talk_answer")
}

model AttachmentHistory {
  id           String     @id @default(cuid())
  attachment   Attachment @relation(fields: [attachmentId], references: [id])
  attachmentId String
  previousUrl  String
  previousName String
  modifiedBy   User       @relation(fields: [userId], references: [id])
  userId       String
  modifiedAt   DateTime   @default(now())
  reason       String?

  @@map("attachment_history")
}

model FileHistory {
  id           String   @id @default(cuid())
  file         File     @relation(fields: [fileId], references: [id])
  fileId       String
  previousUrl  String
  previousName String
  modifiedBy   User     @relation(fields: [userId], references: [id])
  userId       String
  modifiedAt   DateTime @default(now())
  reason       String?

  @@map("file_history")
}

model EquipmentHistory {
  id          String     @id @default(cuid())
  equipment   Equipment  @relation(fields: [equipmentId], references: [id])
  equipmentId String
  changeType  String
  description String
  modifiedBy  User       @relation(fields: [userId], references: [id])
  userId      String
  modifiedAt  DateTime   @default(now())
  status      String
  createdAt   DateTime   @default(now())
  workOrder   WorkOrder? @relation(fields: [workOrderId], references: [id])
  workOrderId String?
  workEntry   WorkEntry? @relation(fields: [workEntryId], references: [id])
  workEntryId String?

  @@unique([id])
  @@map("equipment_history")
}

enum ROOT_FOLDER_TYPE {
  COMPANY_INFORMATION // Datos de la Empresa
  RISK_PREVENTION // MIPER y Plan de Prevención de Riesgos
  WORK_PROCEDURES // Procedimientos de Trabajo y Emergencia
  PERSONNEL_DOCUMENTS // Documentación del Personal
  OCCUPATIONAL_EXAMS // Exámenes Ocupacionales
  INTERNAL_REGULATIONS // Reglamento Interno de Orden, Higiene y Seguridad (RIOHS)
  INFORMATION_DUTIES // Obligaciones de Informar (ODI)
  PPE_DELIVERY // Entrega de Equipos de Protección Personal (EPP)
  PPE_CERTIFICATES // Certificados de EPP
  VEHICLES // Documentación de Vehículos
  SAFETY_ADVISOR // Prevencionista de Riesgos
  LEGAL // Documentación Legal
}

model RootFolder {
  id   String @id @default(cuid())
  slug String @unique

  name        String
  description String?
  type        ROOT_FOLDER_TYPE
  isRoot      Boolean          @default(false)
  isActive    Boolean          @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  files      File[]
  parent     RootFolder?  @relation("RootFolderToFolder", fields: [parentId], references: [id])
  parentId   String?
  subFolders RootFolder[] @relation("RootFolderToFolder")
  user       User?        @relation(fields: [userId], references: [id])
  userId     String?
  company    Company      @relation(fields: [companyId], references: [id])
  companyId  String

  @@map("root_folder")
}

enum PLAN_FREQUENCY {
  MONTHLY
  BIMONTHLY
  QUARTERLY
  FOURMONTHLY
  BIANNUAL
  YEARLY
}

enum MAINTENANCE_PLAN_LOCATION {
  PRS
  TRM
}

model MaintenancePlan {
  id          String                    @id @default(cuid())
  slug        String                    @unique
  name        String
  description String
  location    MAINTENANCE_PLAN_LOCATION
  createdAt   DateTime                  @default(now())
  updatedAt   DateTime                  @updatedAt

  equipment   Equipment             @relation(fields: [equipmentId], references: [id])
  equipmentId String
  createdBy   User                  @relation(fields: [createdById], references: [id])
  createdById String
  task        MaintenancePlanTask[]

  @@map("maintenance_plan")
}

model MaintenancePlanTask {
  id                    String              @id @default(cuid())
  slug                  String              @unique
  name                  String
  description           String
  frequency             PLAN_FREQUENCY
  workOrderType         WORK_ORDER_TYPE
  workOrderCapex        WORK_ORDER_CAPEX
  workOrderPriority     WORK_ORDER_PRIORITY
  nextDate              DateTime
  estimatedDays         Int
  estimatedHours        Int
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  isInternalResponsible Boolean

  equipment         Equipment       @relation(fields: [equipmentId], references: [id])
  equipmentId       String
  attachments       Attachment[]
  maintenancePlan   MaintenancePlan @relation(fields: [maintenancePlanId], references: [id])
  maintenancePlanId String
  responsible       User            @relation("MaintenancePlanTaskResponsible", fields: [responsibleId], references: [id])
  responsibleId     String
  createdBy         User            @relation("MaintenancePlanTaskCreatedBy", fields: [createdById], references: [id])
  createdById       String
  company           Company         @relation(fields: [companyId], references: [id])
  companyId         String
  workOrders        WorkOrder[]

  @@map("maintenance_plan_task")
}
