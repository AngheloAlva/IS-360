generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum USER_ROLE {
  USER
  ADMIN
  OPERATOR
  SUPERVISOR
  PARTNER_COMPANY
}

enum AREAS {
  OPERATIONS // Operaciones
  INSTRUCTIONS // Instructivos
  INTEGRITY_AND_MAINTENANCE // Integridad y Mantencion
  ENVIRONMENT // Medio Ambiente
  OPERATIONAL_SAFETY // Seguridad Operacional
  QUALITY_AND_OPERATIONAL_EXCELLENCE // Calidad y Exelencia Operacional
  REGULATORY_COMPLIANCE // Cumplimiento Normativo
  LEGAL // Juridica
  COMMUNITIES // Comunidades (periodistas?)
  PROJECTS // Proyectos
  PURCHASING // Compras
  ADMINISTRATION_AND_FINANCES // Administración y Finanzas
  IT // Informática
  GERENCY // Gerencia
}

enum MODULES {
  ALL // Todo
  EQUIPMENT // Equipos
  SAFETY_TALK // Charlas de seguridad
  WORK_ORDERS // Ordenes de Trabajo
  WORK_PERMITS // Permisos de Trabajo
  DOCUMENTATION // Documentacion
  NONE // Sin módulo
}

model User {
  id               String    @id
  name             String
  email            String
  emailVerified    Boolean
  image            String?
  phone            String?
  createdAt        DateTime
  updatedAt        DateTime
  modules          MODULES[]
  role             String?
  accessRole       USER_ROLE @default(PARTNER_COMPANY)
  internalRole     String?
  area             AREAS?
  banned           Boolean?
  banReason        String?
  banExpires       DateTime?
  rut              String
  twoFactorEnabled Boolean?
  internal         Boolean   @default(false)
  documentAreas    AREAS[]   @default([])

  sessions                       Session[]
  accounts                       Account[]
  files                          File[]
  folders                        Folder[]
  workTrackers                   WorkTracker[]
  safetyTalks                    UserSafetyTalk[]
  workApplications               WorkApplication[]
  company                        Company?                  @relation(fields: [companyId], references: [id])
  companyId                      String?
  isSupervisor                   Boolean?
  workOrders                     WorkOrder[]               @relation("WorkOrderResponsible")
  workOrdersAsSupervisor         WorkOrder[]               @relation("WorkOrderSupervisor")
  requestedClosures              WorkOrder[]               @relation("WorkOrderClosureRequester")
  approvedClosures               WorkOrder[]               @relation("WorkOrderClosureApprover")
  assignedEntries                WorkEntry[]               @relation("AssignedUsers")
  createdEntries                 WorkEntry[]               @relation("WorkEntryCreator")
  signedEntries                  WorkEntry[]               @relation("WorkEntrySigner")
  workEntries                    WorkEntry[]               @relation("WorkEntryApproval")
  workPermitsAsParticipant       WorkPermit[]              @relation("WorkPermitParticipants")
  workPermitsAsPreventionOfficer WorkPermit[]              @relation("PreventionOfficer")
  workPermits                    WorkPermit[]              @relation("WorkPermitUser")
  attachmentsHistory             AttachmentHistory[]
  equipmentHistory               EquipmentHistory[]
  fileHistory                    FileHistory[]
  twofactors                     TwoFactor[]
  FileComment                    FileComment[]
  MaintenancePlan                MaintenancePlan[]
  MaintenancePlanTask            MaintenancePlanTask[]
  approvedMilestones             Milestone[]               @relation("MilestoneApprover")
  requestedMilestones            Milestone[]               @relation("MilestoneRequestedBy")
  safetyAndHealthFolders         SafetyAndHealthFolder[]
  safetyAndHealthDocuments       SafetyAndHealthDocument[]
  workerFolder                   WorkerFolder[]            @relation("WorkerFolderWorker")
  workerFolderReviewer           WorkerFolder[]            @relation("WorkerFolderReviewer")
  workerDocument                 WorkerDocument[]
  vehicleFolder                  VehicleFolder[]
  vehicleDocument                VehicleDocument[]
  environmentalFolder            EnvironmentalFolder[]
  environmentalDocument          EnvironmentalDocument[]

  @@unique([email])
  @@unique([rut])
  @@map("user")
}

model RutCounter {
  id    String @id @default("rut_counter")
  value Int    @default(1)

  @@map("rut_counter")
}

model TwoFactor {
  id          String
  secret      String?
  backupCodes String?

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  @@unique([id])
  @@unique([userId])
  @@map("twoFactor")
}

model Session {
  id             String   @id
  expiresAt      DateTime
  token          String
  createdAt      DateTime
  updatedAt      DateTime
  ipAddress      String?
  userAgent      String?
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  impersonatedBy String?

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime

  @@map("account")
}

model Company {
  id    String  @id @default(cuid())
  name  String
  rut   String
  image String?

  users          User[]
  workOrders     WorkOrder[]
  workPermits    WorkPermit[]
  vehicles       Vehicle[]
  StartupFolders StartupFolder[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id])
  @@map("company")
}

enum VEHICLE_TYPE {
  CAR
  TRUCK
  MOTORCYCLE
  BUS
  TRACTOR
  TRAILER
  OTHER
  VAN
}

model Vehicle {
  id String @id @default(cuid())

  plate  String
  model  String
  year   Int
  brand  String
  type   VEHICLE_TYPE
  color  String?
  isMain Boolean      @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company         Company         @relation(fields: [companyId], references: [id])
  companyId       String
  workPermits     WorkPermit[]
  vehiclesFolders VehicleFolder[]

  @@map("vehicle")
}

model Verification {
  id         String    @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

enum WORK_ORDER_STATUS {
  PLANNED
  PENDING
  COMPLETED
  CANCELLED
  IN_PROGRESS
  CLOSURE_REQUESTED
}

enum WORK_ORDER_TYPE {
  CORRECTIVE
  PREVENTIVE
  PREDICTIVE
  PROACTIVE
}

enum WORK_ORDER_CAPEX {
  CONFIDABILITY // Confiabilidad
  MITIGATE_RISK // Mitiga riesgo
  COMPLIANCE // Cumplimiento normativo
}

enum WORK_ORDER_PRIORITY {
  HIGH
  MEDIUM
  LOW
}

model WorkOrder {
  id       String @id @default(cuid())
  otNumber String

  type                  WORK_ORDER_TYPE
  status                WORK_ORDER_STATUS          @default(PLANNED)
  solicitationDate      DateTime
  solicitationTime      String
  workRequest           String
  workDescription       String?
  priority              WORK_ORDER_PRIORITY
  capex                 WORK_ORDER_CAPEX?
  equipment             Equipment[]
  programDate           DateTime
  estimatedHours        Float
  estimatedDays         Float
  requiresBreak         Boolean
  breakDays             Int?
  estimatedEndDate      DateTime?
  location              MAINTENANCE_PLAN_LOCATION?
  isWorkBook            Boolean
  isWorkBookInit        Boolean                    @default(false)
  isInternalResponsible Boolean                    @default(false)

  // Work book data
  workName           String?
  workLocation       String?
  workStartDate      DateTime?
  workProgressStatus Float?      @default(0) // Cambiado a Float para precisión en el porcentaje
  workEntries        WorkEntry[]

  company               Company?             @relation(fields: [companyId], references: [id])
  companyId             String?
  supervisor            User                 @relation("WorkOrderSupervisor", fields: [supervisorId], references: [id])
  supervisorId          String
  responsible           User                 @relation("WorkOrderResponsible", fields: [responsibleId], references: [id])
  responsibleId         String
  manualDocuments       Attachment[]         @relation("WorkOrderManualDocuments")
  initReport            Attachment?          @relation("WorkOrderInitReport", fields: [initReportId], references: [id])
  initReportId          String?              @unique
  endReport             Attachment?          @relation("WorkOrderEndReport", fields: [endReportId], references: [id])
  endReportId           String?              @unique
  workPermits           WorkPermit[]
  closureRequestedBy    User?                @relation("WorkOrderClosureRequester", fields: [closureRequestedById], references: [id])
  closureRequestedById  String?
  closureRequestedAt    DateTime?
  closureApprovedBy     User?                @relation("WorkOrderClosureApprover", fields: [closureApprovedById], references: [id])
  closureApprovedById   String?
  closureApprovedAt     DateTime?
  closureRejectedReason String?
  workTrackers          WorkTracker[]
  equipmentHistory      EquipmentHistory[]
  MaintenancePlanTask   MaintenancePlanTask? @relation(fields: [maintenancePlanTaskId], references: [id])
  maintenancePlanTaskId String?
  milestones            Milestone[]
  startupFolder         StartupFolder?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id])
  @@unique([otNumber])
  @@map("work_order")
}

enum MILESTONE_STATUS {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
  REQUESTED_CLOSURE
}

model Milestone {
  id             String           @id @default(cuid())
  name           String
  description    String?
  status         MILESTONE_STATUS @default(PENDING)
  order          Int              @default(0)
  isCompleted    Boolean          @default(false)
  weight         Float
  startDate      DateTime?
  endDate        DateTime?
  approvedAt     DateTime?
  closureComment String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  requestedBy   User?       @relation("MilestoneRequestedBy", fields: [requestedById], references: [id])
  requestedById String?
  approvedBy    User?       @relation("MilestoneApprover", fields: [approvedById], references: [id])
  approvedById  String?
  workOrder     WorkOrder   @relation(fields: [workOrderId], references: [id])
  workOrderId   String
  activities    WorkEntry[]

  @@unique([id])
  @@index([workOrderId, order])
  @@map("milestone")
}

model Equipment {
  id            String  @id @default(cuid())
  barcode       String
  name          String
  description   String?
  location      String
  isOperational Boolean @default(true)
  type          String?
  tag           String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  parent              Equipment?            @relation("EquipmentHierarchy", fields: [parentId], references: [id])
  parentId            String?
  children            Equipment[]           @relation("EquipmentHierarchy")
  workOrders          WorkOrder[]
  history             EquipmentHistory[]
  MaintenancePlan     MaintenancePlan[]
  MaintenancePlanTask MaintenancePlanTask[]
  attachments         Attachment[]

  @@unique([id])
  @@unique([tag])
  @@unique([barcode])
  @@map("equipment")
}

enum WORK_APPLICATION_STATUS {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
  EXPIRED
}

model WorkApplication {
  id String @id @default(cuid())

  description String
  location    String
  status      WORK_APPLICATION_STATUS @default(PENDING)
  criticality String

  attachments   Attachment[]
  responsible   User         @relation(fields: [responsibleId], references: [id])
  responsibleId String

  @@unique([id])
  @@map("work_application")
}

enum ENTRY_TYPE {
  DAILY_ACTIVITY
  ADDITIONAL_ACTIVITY
  PREVENTION_AREA
  OTC_INSPECTION
  COMMENT
  USER_NOTE
}

enum NOTE_STATUS {
  PENDING
  ACKNOWLEDGED
  RESOLVED
}

model WorkEntry {
  id                  String             @id @default(cuid())
  entryType           ENTRY_TYPE
  isFavorite          Boolean            @default(false)
  hasAttachments      Boolean            @default(false)
  executionDate       DateTime           @default(now())
  activityName        String?
  activityStartTime   String?
  activityEndTime     String?
  comments            String?
  supervisionComments String?
  safetyObservations  String?
  nonConformities     String?
  inspectorName       String?
  recommendations     String?
  others              String?
  noteStatus          NOTE_STATUS?       @default(PENDING)
  notificationSent    Boolean            @default(false)
  acknowledgedAt      DateTime?
  resolvedAt          DateTime?
  approvalDate        DateTime?
  approvalBy          User?              @relation("WorkEntryApproval", fields: [approvalById], references: [id])
  approvalById        String?
  createdAt           DateTime           @default(now())
  createdBy           User               @relation("WorkEntryCreator", fields: [createdById], references: [id])
  createdById         String
  signedAt            DateTime?
  signedBy            User?              @relation("WorkEntrySigner", fields: [signedById], references: [id])
  signedById          String?
  workOrder           WorkOrder          @relation(fields: [workOrderId], references: [id])
  workOrderId         String
  milestone           Milestone?         @relation(fields: [milestoneId], references: [id])
  milestoneId         String?
  assignedUsers       User[]             @relation(name: "AssignedUsers")
  referencedEntry     WorkEntry?         @relation("EntryReferences", fields: [referencedEntryId], references: [id])
  referencedEntryId   String?
  referencedBy        WorkEntry[]        @relation("EntryReferences")
  equipmentHistory    EquipmentHistory[]
  attachments         Attachment[]

  @@unique([id])
  @@index([workOrderId, createdAt])
  @@index([milestoneId])
  @@map("work_book_entry")
}

model WorkTracker {
  id String @id @default(cuid())

  description     String
  date            DateTime
  dedicatedHours  Int
  quantityPersons Int
  location        String
  status          String

  user        User         @relation(fields: [userId], references: [id])
  userId      String
  attachments Attachment[]
  otNumber    WorkOrder    @relation(fields: [otNumberId], references: [id])
  otNumberId  String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("work_tracker")
}

model Attachment {
  id String @id @default(cuid())

  name String
  url  String
  type String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workApplication       WorkApplication?     @relation(fields: [workApplicationId], references: [id])
  workApplicationId     String?
  workEntry             WorkEntry?           @relation(fields: [workEntryId], references: [id])
  workEntryId           String?
  workTracker           WorkTracker?         @relation(fields: [workTrackerId], references: [id])
  workTrackerId         String?
  manualDocuments       WorkOrder[]          @relation("WorkOrderManualDocuments")
  initReport            WorkOrder?           @relation("WorkOrderInitReport")
  initReportId          String?              @unique
  endReport             WorkOrder?           @relation("WorkOrderEndReport")
  endReportId           String?              @unique
  history               AttachmentHistory[]
  MaintenancePlanTask   MaintenancePlanTask? @relation(fields: [maintenancePlanTaskId], references: [id])
  maintenancePlanTaskId String?
  equipment             Equipment?           @relation(fields: [equipmentId], references: [id])
  equipmentId           String?

  @@map("attachment")
}

enum WORK_PERMIT_STATUS {
  ACTIVE
  IN_PROGRESS
  COMPLETED
  CANCELLED
  EXPIRED
}

model WorkPermit {
  id                             String             @id @default(cuid())
  status                         WORK_PERMIT_STATUS @default(ACTIVE)
  aplicantPt                     String
  mutuality                      String
  otherMutuality                 String?
  exactPlace                     String
  workWillBe                     String
  workWillBeOther                String?
  tools                          String[]
  otherTools                     String?
  preChecks                      String[]
  otherPreChecks                 String?
  activityDetails                String[]
  riskIdentification             String[]
  otherRisk                      String?
  preventiveControlMeasures      String[]
  otherPreventiveControlMeasures String?
  generateWaste                  Boolean
  wasteType                      String?
  wasteDisposalLocation          String?
  whoDeliversWorkAreaOp          String
  workerExecutor                 String
  workCompleted                  Boolean?
  cleanAndTidyWorkArea           Boolean?
  additionalObservations         String?
  observations                   String?
  acceptTerms                    Boolean            @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  preventionOfficerUser User      @relation("PreventionOfficer", fields: [preventionOfficerId], references: [id])
  preventionOfficerId   String
  otNumber              WorkOrder @relation(fields: [otNumberId], references: [id])
  otNumberId            String
  user                  User      @relation("WorkPermitUser", fields: [userId], references: [id])
  userId                String
  participants          User[]    @relation("WorkPermitParticipants")
  company               Company   @relation(fields: [companyId], references: [id])
  companyId             String
  vehicles              Vehicle[]

  @@map("work_permit")
}

model Folder {
  id   String @id @default(cuid())
  slug String

  name        String
  description String?
  root        Boolean @default(false)
  area        AREAS
  type        String  @default("default")
  isExternal  Boolean @default(false)
  isActive    Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  parent     Folder?  @relation("FolderToFolder", fields: [parentId], references: [id])
  parentId   String?
  subFolders Folder[] @relation("FolderToFolder")
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  files      File[]

  @@unique([slug, parentId, userId])
  @@map("folder")
}

model File {
  id String @id @default(cuid())

  code             String?
  name             String
  description      String?
  area             AREAS?
  type             String
  size             Int
  url              String
  registrationDate DateTime
  expirationDate   DateTime?
  revisionCount    Int       @default(0)
  isExternal       Boolean   @default(false)
  isActive         Boolean   @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  history  FileHistory[]
  folder   Folder?       @relation(fields: [folderId], references: [id], onDelete: Cascade)
  folderId String?
  user     User          @relation(fields: [userId], references: [id])
  userId   String
  comments FileComment[]

  @@map("file")
}

model FileComment {
  id String @id @default(cuid())

  title   String?
  content String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id])
  userId String
  file   File   @relation(fields: [fileId], references: [id])
  fileId String

  @@map("file_comment")
}

model Counter {
  id    String @id @default("ot_counter")
  value Int    @default(1)
}

enum RESOURCE_TYPE {
  VIDEO
  PRESENTATION
  DOCUMENT
}

model SafetyTalk {
  id                String               @id @default(cuid())
  slug              String               @unique
  title             String
  description       String?
  isPresential      Boolean              @default(false)
  questions         Question[]
  resources         SafetyTalkResource[]
  expiresAt         DateTime
  timeLimit         Int?
  minimumScore      Float                @default(70.0)
  pdfGenerations    Int                  @default(0)
  lastPdfGeneration DateTime?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt

  userSafetyTalks UserSafetyTalk[]

  @@map("safety_talk")
}

model SafetyTalkResource {
  id           String        @id @default(cuid())
  title        String
  description  String?
  type         RESOURCE_TYPE
  url          String
  fileSize     Int?
  mimeType     String?
  order        Int
  safetyTalk   SafetyTalk    @relation(fields: [safetyTalkId], references: [id])
  safetyTalkId String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@map("safety_talk_resource")
}

enum QUESTION_TYPE {
  MULTIPLE_CHOICE // Opción múltiple tradicional
  IMAGE_ZONES // Preguntas con zonas en imágenes
  TRUE_FALSE // Verdadero/Falso
  SHORT_ANSWER // Respuesta corta
}

model Question {
  id           String           @id @default(cuid())
  type         QUESTION_TYPE    @default(MULTIPLE_CHOICE)
  question     String
  imageUrl     String?
  description  String?
  options      QuestionOption[]
  safetyTalk   SafetyTalk       @relation(fields: [safetyTalkId], references: [id])
  safetyTalkId String
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  userAnswers UserSafetyTalkAnswer[]

  @@map("question")
}

model QuestionOption {
  id         String   @id @default(cuid())
  text       String
  isCorrect  Boolean
  zoneLabel  String? // Para IMAGE_ZONES, etiqueta de la zona (ej: 'A', 'B', 'C')
  zoneId     String? // Identificador único de la zona en la imagen
  order      Int      @default(0) // Orden de la opción
  question   Question @relation(fields: [questionId], references: [id])
  questionId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  userAnswers UserSafetyTalkAnswer[]

  @@map("question_option")
}

model UserSafetyTalk {
  id           String                 @id @default(cuid())
  user         User                   @relation(fields: [userId], references: [id])
  userId       String
  safetyTalk   SafetyTalk             @relation(fields: [safetyTalkId], references: [id])
  safetyTalkId String
  score        Float
  passed       Boolean
  completedAt  DateTime
  expiresAt    DateTime
  answers      UserSafetyTalkAnswer[]
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt

  @@map("user_safety_talk")
}

model UserSafetyTalkAnswer {
  id               String         @id @default(cuid())
  userSafetyTalk   UserSafetyTalk @relation(fields: [userSafetyTalkId], references: [id])
  userSafetyTalkId String
  question         Question       @relation(fields: [questionId], references: [id])
  questionId       String
  selectedOption   QuestionOption @relation(fields: [selectedOptionId], references: [id])
  selectedOptionId String
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  @@map("user_safety_talk_answer")
}

model AttachmentHistory {
  id           String     @id @default(cuid())
  attachment   Attachment @relation(fields: [attachmentId], references: [id])
  attachmentId String
  previousUrl  String
  previousName String
  modifiedBy   User       @relation(fields: [userId], references: [id])
  userId       String
  modifiedAt   DateTime   @default(now())
  reason       String?

  @@map("attachment_history")
}

model FileHistory {
  id           String   @id @default(cuid())
  file         File     @relation(fields: [fileId], references: [id])
  fileId       String
  previousUrl  String
  previousName String
  modifiedBy   User     @relation(fields: [userId], references: [id])
  userId       String
  modifiedAt   DateTime @default(now())
  reason       String?

  @@map("file_history")
}

model EquipmentHistory {
  id          String     @id @default(cuid())
  equipment   Equipment  @relation(fields: [equipmentId], references: [id])
  equipmentId String
  changeType  String
  description String
  modifiedBy  User       @relation(fields: [userId], references: [id])
  userId      String
  modifiedAt  DateTime   @default(now())
  status      String
  createdAt   DateTime   @default(now())
  workOrder   WorkOrder? @relation(fields: [workOrderId], references: [id])
  workOrderId String?
  workEntry   WorkEntry? @relation(fields: [workEntryId], references: [id])
  workEntryId String?

  @@unique([id])
  @@map("equipment_history")
}

enum PLAN_FREQUENCY {
  DAILY
  WEEKLY
  MONTHLY
  BIMONTHLY
  QUARTERLY
  FOURMONTHLY
  BIANNUAL
  YEARLY
}

enum MAINTENANCE_PLAN_LOCATION {
  PRS
  TRM
}

model MaintenancePlan {
  id          String                    @id @default(cuid())
  slug        String                    @unique
  name        String
  description String
  location    MAINTENANCE_PLAN_LOCATION
  createdAt   DateTime                  @default(now())
  updatedAt   DateTime                  @updatedAt

  equipment   Equipment             @relation(fields: [equipmentId], references: [id])
  equipmentId String
  createdBy   User                  @relation(fields: [createdById], references: [id])
  createdById String
  task        MaintenancePlanTask[]

  @@map("maintenance_plan")
}

model MaintenancePlanTask {
  id          String                     @id @default(cuid())
  slug        String                     @unique
  name        String
  description String?
  frequency   PLAN_FREQUENCY
  nextDate    DateTime
  createdAt   DateTime                   @default(now())
  updatedAt   DateTime                   @updatedAt
  location    MAINTENANCE_PLAN_LOCATION?

  equipment         Equipment       @relation(fields: [equipmentId], references: [id])
  equipmentId       String
  attachments       Attachment[]
  maintenancePlan   MaintenancePlan @relation(fields: [maintenancePlanId], references: [id])
  maintenancePlanId String
  createdBy         User            @relation(fields: [createdById], references: [id])
  createdById       String
  workOrders        WorkOrder[]

  @@map("maintenance_plan_task")
}

enum ReviewStatus {
  DRAFT // Edicion
  SUBMITTED // Enviado
  APPROVED // Aprovado
  REJECTED // Rechazado
  EXPIRED // Expirado
}

enum SafetyAndHealthDocumentType {
  // Información Básica
  COMPANY_INFO // Ficha empresa
  STAFF_LIST // Nómina de personal
  GANTT_CHART // Carta Gantt
  MUTUAL // Certificado de adhesión a mutualidad
  INTERNAL_REGULATION // Reglamento interno
  ACCIDENT_RATE // Certificado de siniestralidad
  // Procedimientos y Otros
  RISK_MATRIX // Matriz de Identificación de peligros y evaluación de Riesgos
  PREVENTION_PLAN // Plan de Prevención de riesgos
  WORK_PROCEDURE // Procedimiento de trabajos
  EMERGENCY_PROCEDURE // Procedimientos de Emergencia
  TOOLS_MAINTENANCE // Programa de Mantención de Herramientas y Equipos
  PPE_CERTIFICATION // Certificación de elementos de Protección Personal
  HARASSMENT_PROCEDURE // Procedimiento de Acoso Laboral, Sexual y Violencia
  ORGANIZATION_CHART // Organigrama
  SAFE_WORK // Trabajo seguro
  RISK_ANALYSIS // Análisis de riesgos
  WORK_PERMIT // Permiso de trabajo
}

enum WorkerDocumentType {
  CONTRACT // Contrato de Trabajo
  INTERNAL_REGULATION_RECEIPT // Entrega de Reglamento Interno
  RISK_INFORMATION // Inducción de Riesgos Laborales (IRL)
  ID_CARD // Cédula de identidad
  DRIVING_LICENSE // Licencias de conducir
  HEALTH_EXAM // Examen médico vigente
  PSYCHOTECHNICAL_EXAM // Examen Psico sensotécnico
  RISK_MATRIX_TRAINING // Capacitación de la matriz de identificación de peligros
  WORK_PROCEDURE_TRAINING // Capacitación del procedimiento de trabajo
  EMERGENCY_PROCEDURE_TRAINING // Capacitación del Procedimiento de Emergencia
  DEFENSIVE_DRIVING_TRAINING // Capacitación curso manejo defensivo
  MOUNTAIN_DEFENSIVE_DRIVING // Curso de manejo defensivo en alta montaña
  TOOLS_MAINTENANCE_TRAINING // Capacitación del procedimiento de Mantención de Herramientas
  HARASSMENT_TRAINING // Capacitación de la Ley Karin
  PPE_RECEIPT // Entrega de Elementos de Protección personal
  PREVENTION_EXPERT // Experto en Prevención de riesgos
  HIGH_RISK_TRAINING // Cursos para trabajos de alto riesgo
  ENVIRONMENTAL_TRAINING // Capacitaciones ambientales
}

enum VehicleDocumentType {
  EQUIPMENT_FILE // Ficha de equipos
  VEHICLE_REGISTRATION // Inscripción del Vehículo Motorizado (Padrón)
  CIRCULATION_PERMIT // Permiso de circulación
  TECHNICAL_REVIEW // Revisión técnica
  INSURANCE // Seguro Obligatorio
  CHECKLIST // Lista de chequeo previa al ingreso
  HAZARDOUS_WASTE_TRANSPORT // Resolución sanitaria para transporte de residuos peligrosos
  NON_HAZARDOUS_WASTE_TRANSPORT // Resolución sanitaria para transporte de residuos No peligrosos
  LIQUID_WASTE_TRANSPORT // Resolución sanitaria para transporte de residuos domésticos líquidos
}

enum EnvironmentalDocType {
  ENVIRONMENTAL_PLAN // Plan de Gestión ambiental
  SPILL_PREVENTION // Procedimiento de Prevención y control de derrames
  WASTE_MANAGEMENT // Procedimiento de manejo de residuos
  ENVIRONMENTAL_TRAINING // Capacitaciones ambientales
  ENVIRONMENTAL_MATRIX // Matriz de identificación y evaluación de aspectos ambientales
  RECT_CERTIFICATE // Certificado RECT
  WATER_CERTIFICATE // Certificado compra de agua potable
  WATER_FACTORY_RESOLUTION // Resolución sanitaria fábrica de botellones de agua
  DINING_RESOLUTION // Resolución sanitaria comedor
  CHEMICAL_TOILET_CONTRACT // Contrato servicio de limpieza de baños químicos
  SAFETY_DATA_SHEET // Hojas de datos de seguridad de sustancias químicas
  LAYOUT_PLAN // Plano layout de instalación de faenas
  ELECTRICAL_DECLARATION // TE 1, Declaración de instalación eléctrica
  GAS_DECLARATION // TC 6, Declaración de instalaciones interiores de gas
  PEST_CONTROL_RESOLUTION // Resolución sanitaria de control de plagas
  PEST_CONTROL_CERTIFICATE // Certificado mensual de desratización, desinsectación y sanitización
  HAZARDOUS_STORAGE_CHECKLIST // Check list de Bodega de almacenamiento
  HAZARDOUS_INVENTORY // Inventario mensual de sustancias peligrosas
  FUEL_CONSUMPTION // Planilla de registro de consumo de combustible
  WATER_CONSUMPTION // Planilla de registro mensual de consumo de agua
}

enum DocumentCategory {
  VEHICLES
  PERSONNEL
  ENVIRONMENTAL
  SAFETY_AND_HEALTH
}

model StartupFolder {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workersFolders         WorkerFolder[]
  vehiclesFolders        VehicleFolder[]
  safetyAndHealthFolders SafetyAndHealthFolder[]
  environmentalFolders   EnvironmentalFolder[]
  company                Company                 @relation(fields: [companyId], references: [id])
  companyId              String
  workOrder              WorkOrder?              @relation(fields: [workOrderId], references: [id])
  workOrderId            String?                 @unique

  @@map("startup_folder")
}

model SafetyAndHealthFolder {
  id                           String       @id @default(cuid())
  status                       ReviewStatus @default(DRAFT)
  additionalNotificationEmails String[]
  submittedAt                  DateTime?
  createdAt                    DateTime     @default(now())
  updatedAt                    DateTime     @updatedAt

  reviewerId      String?
  reviewer        User?                     @relation(fields: [reviewerId], references: [id])
  startupFolderId String
  startupFolder   StartupFolder             @relation(fields: [startupFolderId], references: [id])
  documents       SafetyAndHealthDocument[]

  @@unique([startupFolderId])
  @@map("safety_and_health_folder")
}

model SafetyAndHealthDocument {
  id             String                      @id @default(uuid())
  type           SafetyAndHealthDocumentType
  name           String
  url            String
  uploadedAt     DateTime                    @default(now())
  category       DocumentCategory
  status         ReviewStatus                @default(DRAFT)
  reviewNotes    String?
  reviewedAt     DateTime?
  submittedAt    DateTime?
  expirationDate DateTime?

  uploadedById String?
  uploadedBy   User?                 @relation(fields: [uploadedById], references: [id])
  folderId     String
  folder       SafetyAndHealthFolder @relation(fields: [folderId], references: [id])

  @@map("safety_and_health_document")
}

model WorkerFolder {
  id                           String       @id @default(cuid())
  status                       ReviewStatus @default(DRAFT)
  additionalNotificationEmails String[]
  submittedAt                  DateTime?
  createdAt                    DateTime     @default(now())
  updatedAt                    DateTime     @updatedAt

  reviewerId      String?
  reviewer        User?            @relation("WorkerFolderReviewer", fields: [reviewerId], references: [id])
  workerId        String
  worker          User             @relation("WorkerFolderWorker", fields: [workerId], references: [id])
  startupFolderId String
  startupFolder   StartupFolder    @relation(fields: [startupFolderId], references: [id])
  documents       WorkerDocument[]

  @@unique([workerId, startupFolderId])
  @@map("worker_folders")
}

model WorkerDocument {
  id             String             @id @default(uuid())
  type           WorkerDocumentType
  name           String
  url            String
  uploadedAt     DateTime           @default(now())
  category       DocumentCategory
  status         ReviewStatus       @default(DRAFT)
  reviewNotes    String?
  reviewedAt     DateTime?
  submittedAt    DateTime?
  expirationDate DateTime?

  uploadedById String?
  uploadedBy   User?        @relation(fields: [uploadedById], references: [id])
  folder       WorkerFolder @relation(fields: [folderId], references: [id])
  folderId     String

  @@map("worker_document")
}

model VehicleFolder {
  id                           String       @id @default(cuid())
  status                       ReviewStatus @default(DRAFT)
  additionalNotificationEmails String[]
  submittedAt                  DateTime?
  createdAt                    DateTime     @default(now())
  updatedAt                    DateTime     @updatedAt

  vehicleId       String
  startupFolderId String
  reviewerId      String?
  reviewer        User?             @relation(fields: [reviewerId], references: [id])
  vehicle         Vehicle           @relation(fields: [vehicleId], references: [id])
  startupFolder   StartupFolder     @relation(fields: [startupFolderId], references: [id])
  documents       VehicleDocument[]

  @@unique([vehicleId, startupFolderId])
  @@map("vehicle_folders")
}

model VehicleDocument {
  id             String              @id @default(uuid())
  type           VehicleDocumentType
  name           String
  url            String
  uploadedAt     DateTime            @default(now())
  category       DocumentCategory
  status         ReviewStatus        @default(DRAFT)
  reviewNotes    String?
  reviewedAt     DateTime?
  submittedAt    DateTime?
  expirationDate DateTime?

  uploadedById String?
  uploadedBy   User?         @relation(fields: [uploadedById], references: [id])
  folderId     String
  folder       VehicleFolder @relation(fields: [folderId], references: [id])

  @@map("vehicle_document")
}

model EnvironmentalFolder {
  id                           String       @id @default(cuid())
  status                       ReviewStatus @default(DRAFT)
  additionalNotificationEmails String[]
  submittedAt                  DateTime?
  createdAt                    DateTime     @default(now())
  updatedAt                    DateTime     @updatedAt

  reviewerId      String?
  reviewer        User?                   @relation(fields: [reviewerId], references: [id])
  startupFolderId String
  startupFolder   StartupFolder           @relation(fields: [startupFolderId], references: [id])
  documents       EnvironmentalDocument[]

  @@unique([startupFolderId])
  @@map("environmental_folder")
}

model EnvironmentalDocument {
  id             String               @id @default(uuid())
  type           EnvironmentalDocType
  name           String
  url            String
  uploadedAt     DateTime             @default(now())
  category       DocumentCategory
  status         ReviewStatus         @default(DRAFT)
  reviewNotes    String?
  reviewedAt     DateTime?
  submittedAt    DateTime?
  expirationDate DateTime?

  uploadedById String?
  uploadedBy   User?               @relation(fields: [uploadedById], references: [id])
  folderId     String
  folder       EnvironmentalFolder @relation(fields: [folderId], references: [id])

  @@map("environmental_document")
}
